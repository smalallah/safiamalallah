<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CV Object Builder + CV Renderer + Data Editor</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @media print {
      .no-print { display: none !important; }
      body { background: white !important; }
    }
    textarea { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  </style>
</head>
<body class="min-h-screen bg-gray-50">
  <div id="root"></div>

  <!-- React + ReactDOM + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useMemo, useEffect } = React;

    // Theme
    const ACCENT = "#6B21A8"; // purple
    const LIGHT_ACCENT = "#F3E8FF";

    // Categories and roles
    const CATEGORY_OPTIONS = [
      "Education & Credentials",
      "Academic Positions",
      "Industry Experience",
      "Grants & Funding",
      "Publications",
      "Developed Tools & Educational Resources",
      "Workshops, Seminars & Panels",
      "Teaching Experience",
      "Application Development Projects",
      "Academic Committees & Service",
      "Professional & Community Memberships",
      "Conference & Event Participation",
      "Student Supervision",
      "Collaborations & Partnerships",
      "Collaboration Opportunities",
      "Awards & Recognitions",
    ];

    const DEFAULT_ROLE_OPTIONS = [
      "Instructor","Organizer","Panelist","Presenter","Author","Co-PI","PI",
      "Advisor","Reviewer","Member","Developer","Designer","Researcher",
    ];

    // Utils
    const slugify = (text="") => text.toString().toLowerCase().trim().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,"");
    const todayISO = () => {
      const d = new Date(); const off = d.getTimezoneOffset();
      const local = new Date(d.getTime() - off*60*1000);
      return local.toISOString().slice(0,10);
    };
    const downloadJSON = (filename, data) => {
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a"); a.href = url; a.download = filename; a.click();
      URL.revokeObjectURL(url);
    };
    const readJSONFile = (file) => new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => { try { resolve(JSON.parse(reader.result)); } catch(e){ reject(e); } };
      reader.onerror = reject; reader.readAsText(file);
    });

    // Components
    function ChipInput({ label, placeholder, values, setValues }) {
      const [input, setInput] = useState("");
      return (
        <div className="flex flex-col gap-2">
          <label className="text-sm font-medium">{label}</label>
          <div className="flex gap-2">
            <input className="flex-1 rounded-xl border px-3 py-2 outline-none focus:ring-2"
              placeholder={placeholder} value={input}
              onChange={(e)=>setInput(e.target.value)}
              onKeyDown={(e)=>{ if((e.key==="Enter"||e.key===",") && input.trim()){ e.preventDefault(); if(!values.includes(input.trim())) setValues([...values, input.trim()]); setInput(""); }}}/>
            <button type="button" className="rounded-xl px-4 py-2 border shadow-sm"
              onClick={()=>{ if(input.trim() && !values.includes(input.trim())) setValues([...values, input.trim()]); setInput(""); }}>Add</button>
          </div>
          {values?.length>0 && (
            <div className="flex flex-wrap gap-2">
              {values.map(v=> (
                <span key={v} className="inline-flex items-center gap-2 rounded-full border px-3 py-1 text-sm">
                  {v}
                  <button type="button" className="opacity-60 hover:opacity-100" onClick={()=>setValues(values.filter(x=>x!==v))}>×</button>
                </span>
              ))}
            </div>
          )}
        </div>
      );
    }

    function MultiSelect({ label, options, selected, setSelected }) {
      const [query, setQuery] = useState("");
      const filtered = useMemo(()=> options.filter(o=>o.toLowerCase().includes(query.toLowerCase())), [options, query]);
      return (
        <div className="flex flex-col gap-2">
          <label className="text-sm font-medium">{label}</label>
          <input className="rounded-xl border px-3 py-2 outline-none focus:ring-2" placeholder="Search..." value={query} onChange={(e)=>setQuery(e.target.value)} />
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 max-h-52 overflow-auto rounded-xl border p-2">
            {filtered.map(o=>{
              const active = selected.includes(o);
              return (
                <button type="button" key={o}
                  onClick={()=> setSelected(active ? selected.filter(x=>x!==o) : [...selected, o])}
                  className={"text-left rounded-lg px-3 py-2 border " + (active ? "ring-2 ring-purple-600" : "hover:bg-gray-50")}>
                  {o}
                </button>
              );
            })}
          </div>
          {selected.length>0 && (
            <div className="flex flex-wrap gap-2">
              {selected.map(v=> (
                <span key={v} className="inline-flex items-center gap-2 rounded-full border px-3 py-1 text-sm">
                  {v}
                  <button type="button" className="opacity-60 hover:opacity-100" onClick={()=>setSelected(selected.filter(x=>x!==v))}>×</button>
                </span>
              ))}
            </div>
          )}
        </div>
      );
    }

    // Helper to rebuild category map from objects
    const rebuildByCategory = (objects=[]) => {
      const map = {};
      objects.forEach(o => (o.categories||[]).forEach(c => {
        if(!map[c]) map[c] = [];
        map[c].push(o);
      }));
      return map;
    };

    // Builder Tab
    function Builder({ objects, setObjects, byCategory, setByCategory }){
      const [title, setTitle] = useState("");
      const [description, setDescription] = useState("");
      const [dateStart, setDateStart] = useState(todayISO());
      const [dateEnd, setDateEnd] = useState("");
      const [isCurrent, setIsCurrent] = useState(false);
      const [location, setLocation] = useState("");
      const [organization, setOrganization] = useState("");
      const [roles, setRoles] = useState([]);
      const [categories, setCategories] = useState([]);
      const [tags, setTags] = useState([]);
      const [links, setLinks] = useState([]);
      const [notes, setNotes] = useState("");
      const [roleOptions, setRoleOptions] = useState(DEFAULT_ROLE_OPTIONS);
      const [customRole, setCustomRole] = useState("");

      const resetForm = () => {
        setTitle(""); setDescription(""); setDateStart(todayISO()); setDateEnd(""); setIsCurrent(false);
        setLocation(""); setOrganization(""); setRoles([]); setCategories([]); setTags([]); setLinks([]); setNotes("");
      };

      const addObject = () => {
        if(!title.trim()) return alert("Title is required.");
        if(categories.length===0) return alert("Please select at least one category.");
        const id = `${dateStart || todayISO()}-${slugify(title)}-${Date.now().toString().slice(-5)}`;
        const obj = {
          id, title: title.trim(), description: description.trim(),
          date_start: dateStart || null,
          date_end: isCurrent ? "Present" : (dateEnd || null),
          location: location.trim() || null,
          organization: organization.trim() || null,
          roles: roles.length? roles : null,
          categories: [...categories],
          tags: tags.length? tags : null,
          links: links.length? links : null,
          notes: notes.trim() || null,
          current: isCurrent || false,
        };
        const newObjects = [obj, ...objects];
        setObjects(newObjects);
        setByCategory(rebuildByCategory(newObjects));
        resetForm();
      };

      const handleImport = async (e, kind) => {
        const file = e.target.files?.[0]; if(!file) return;
        try {
          const json = await readJSONFile(file);
          if(kind==="objects"){
            const merged = [...objects]; const ids = new Set(merged.map(o=>o.id));
            (json||[]).forEach(o=>{ if(!ids.has(o.id)) merged.push(o); });
            const sorted = merged.sort((a,b)=> (b.date_start||"").localeCompare(a.date_start||""));
            setObjects(sorted); setByCategory(rebuildByCategory(sorted));
          } else if (kind==="byCategory"){
            setByCategory({ ...(byCategory||{}), ...(json||{}) });
          }
        } catch { alert("Invalid JSON"); }
      };

      const exportAll = () => {
        downloadJSON("cv_objects.json", objects);
        downloadJSON("cv_by_category.json", byCategory);
      };

      const categoriesCount = useMemo(()=> Object.fromEntries(CATEGORY_OPTIONS.map(c=>[c,(byCategory[c]||[]).length])), [byCategory]);

      return (
        <div className="mx-auto max-w-6xl px-4 py-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
          <section className="lg:col-span-2">
            <div className="rounded-2xl bg-white p-4 md:p-6 shadow-sm border">
              <h2 className="text-xl font-semibold mb-4">Create a New Object</h2>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="flex flex-col gap-2 md:col-span-2">
                  <label className="text-sm font-medium">Title *</label>
                  <input className="rounded-xl border px-3 py-2 outline-none focus:ring-2" placeholder="e.g., CS for Elementary Learners Workshop" value={title} onChange={(e)=>setTitle(e.target.value)} />
                </div>
                <div className="flex flex-col gap-2 md:col-span-2">
                  <label className="text-sm font-medium">Description</label>
                  <textarea className="rounded-xl border px-3 py-2 outline-none focus:ring-2 min-h-[100px]" placeholder="A one or two sentence summary for the CV." value={description} onChange={(e)=>setDescription(e.target.value)} />
                </div>
                <div className="flex flex-col gap-2">
                  <label className="text-sm font-medium">Start Date</label>
                  <input type="date" className="rounded-xl border px-3 py-2" value={dateStart} onChange={(e)=>setDateStart(e.target.value)} />
                </div>
                <div className="flex flex-col gap-2">
                  <label className="text-sm font-medium">End Date</label>
                  <div className="flex items-center gap-2">
                    <input type="date" className="rounded-xl border px-3 py-2 flex-1" value={dateEnd} onChange={(e)=>setDateEnd(e.target.value)} disabled={isCurrent} />
                    <label className="flex items-center gap-1 text-sm">
                      <input type="checkbox" checked={isCurrent} onChange={(e)=>{ setIsCurrent(e.target.checked); if(e.target.checked) setDateEnd("Present"); else setDateEnd(""); }} /> Current
                    </label>
                  </div>
                </div>
                <div className="flex flex-col gap-2">
                  <label className="text-sm font-medium">Location</label>
                  <input className="rounded-xl border px-3 py-2" placeholder="City, State, Country" value={location} onChange={(e)=>setLocation(e.target.value)} />
                </div>
                <div className="flex flex-col gap-2">
                  <label className="text-sm font-medium">Organization</label>
                  <input className="rounded-xl border px-3 py-2" placeholder="Institution or company name" value={organization} onChange={(e)=>setOrganization(e.target.value)} />
                </div>

                <div className="md:col-span-2">
                  <MultiSelect label="Roles (choose any)" options={roleOptions} selected={roles} setSelected={setRoles} />
                  <div className="mt-3 flex gap-2 items-center">
                    <input className="rounded-xl border px-3 py-2" placeholder="Add custom role (e.g., Co-chair)" value={customRole} onChange={(e)=>setCustomRole(e.target.value)} />
                    <button type="button" className="rounded-xl border px-4 py-2" onClick={()=>{
                      const r = (customRole||"").trim(); if(!r) return;
                      if(!roleOptions.includes(r)) setRoleOptions([...roleOptions, r]);
                      if(!roles.includes(r)) setRoles([...roles, r]); setCustomRole("");
                    }}>Add Role</button>
                  </div>
                </div>

                <div className="md:col-span-2">
                  <MultiSelect label="Categories *" options={CATEGORY_OPTIONS} selected={categories} setSelected={setCategories} />
                </div>

                <div className="md:col-span-2">
                  <ChipInput label="Tags" placeholder="Type a tag and press Enter (e.g., K-5, Python, NSF)" values={tags} setValues={setTags} />
                </div>
                <div className="md:col-span-2">
                  <ChipInput label="Links" placeholder="Paste a URL and press Enter (e.g., https://doi.org/...)" values={links} setValues={setLinks} />
                </div>

                <div className="flex flex-col gap-2 md:col-span-2">
                  <label className="text-sm font-medium">Private Notes</label>
                  <textarea className="rounded-xl border px-3 py-2 outline-none focus:ring-2 min-h-[80px]" placeholder="Internal notes only (not for CV rendering)." value={notes} onChange={(e)=>setNotes(e.target.value)} />
                </div>
              </div>
              <div className="mt-6 flex flex-wrap items-center gap-3">
                <button onClick={addObject} className="rounded-2xl px-5 py-2.5 bg-black text-white shadow-md">Add Object</button>
                <button onClick={resetForm} className="rounded-2xl px-5 py-2.5 border">Reset</button>
                <div className="text-sm text-gray-600">* Required fields</div>
              </div>
            </div>
          </section>

          <aside className="space-y-6">
            <div className="rounded-2xl bg-white p-4 md:p-6 shadow-sm border">
              <h3 className="text-lg font-semibold mb-3">Category Counts</h3>
              <div className="grid grid-cols-1 gap-2 max-h-[360px] overflow-auto pr-1">
                {CATEGORY_OPTIONS.map(c=> (
                  <div key={c} className="flex items-center justify-between gap-3 border rounded-xl px-3 py-2">
                    <span className="text-sm">{c}</span>
                    <span className="text-xs rounded-full border px-2 py-0.5">{(byCategory[c]||[]).length}</span>
                  </div>
                ))}
              </div>
            </div>

            <div className="rounded-2xl bg-white p-4 md:p-6 shadow-sm border">
              <h3 className="text-lg font-semibold mb-3">Import / Export</h3>
              <div className="flex flex-col gap-2">
                <label className="cursor-pointer rounded-xl border px-3 py-2 bg-white shadow-sm text-sm">Import objects.json
                  <input type="file" className="hidden" accept="application/json" onChange={(e)=>handleImport(e,"objects")} />
                </label>
                <label className="cursor-pointer rounded-xl border px-3 py-2 bg-white shadow-sm text-sm">Import by_category.json
                  <input type="file" className="hidden" accept="application/json" onChange={(e)=>handleImport(e,"byCategory")} />
                </label>
                <button onClick={exportAll} className="w-full rounded-2xl px-5 py-2.5 bg-black text-white shadow-md">Download JSONs</button>
              </div>
            </div>
          </aside>
        </div>
      );
    }

    // CV Renderer Tab
    function CVRenderer({ objects, byCategory }){
      const buildCategoryMap = useMemo(()=> {
        if (Object.keys(byCategory||{}).length) return byCategory;
        return rebuildByCategory(objects);
      }, [objects, byCategory]);

      const Section = ({ title, items }) => {
        if(!items || items.length===0) return null;
        return (
          <section className="mb-6">
            <h3 className="text-lg font-semibold mb-2" style={{color: ACCENT}}>{title}</h3>
            <div className="space-y-3">
              {items.map((o)=> (
                <div key={o.id} className="rounded-xl border p-3 bg-white">
                  <div className="flex flex-wrap items-baseline justify-between gap-2">
                    <div className="font-medium">{o.title}</div>
                    <div className="text-xs text-gray-600">{o.date_start}{o.date_end? ` – ${o.date_end}`: ""}</div>
                  </div>
                  {o.organization && <div className="text-sm text-gray-700">{o.organization}{o.location? ` — ${o.location}`: ""}</div>}
                  {o.description && <p className="text-sm mt-1">{o.description}</p>}
                  {o.roles && <div className="text-xs mt-1"><span className="font-medium">Roles:</span> {(o.roles||[]).join(", ")}</div>}
                  {o.links && <div className="text-xs mt-1 space-x-2">{(o.links||[]).map((L,i)=>(<a key={i} href={L} className="underline" target="_blank" rel="noreferrer">Link {i+1}</a>))}</div>}
                </div>
              ))}
            </div>
          </section>
        );
      };

      return (
        <div className="mx-auto max-w-4xl px-4 py-6">
          <div className="rounded-2xl border p-6 bg-white">
            <h1 className="text-3xl font-bold" style={{color: ACCENT}}>Safia A. Malallah</h1>
            <p className="text-sm text-gray-700 mt-1">Learning Scientist / Computer Science Educator</p>
          </div>

          <div className="mt-6">
            <Section title="Education" items={buildCategoryMap["Education & Credentials"]} />
            <Section title="Academic Experience" items={buildCategoryMap["Academic Positions"]} />
            <Section title="Industry Experience" items={buildCategoryMap["Industry Experience"]} />
            <Section title="Grants & Funding" items={buildCategoryMap["Grants & Funding"]} />
            <Section title="Publications" items={buildCategoryMap["Publications"]} />
            <Section title="Developed Tools & Educational Resources" items={buildCategoryMap["Developed Tools & Educational Resources"]} />
            <Section title="Workshops, Colloquia, and Seminars" items={buildCategoryMap["Workshops, Seminars & Panels"]} />
            <Section title="Teaching Experience" items={buildCategoryMap["Teaching Experience"]} />
            <Section title="Application Development Experience" items={buildCategoryMap["Application Development Projects"]} />
            <Section title="Academic Committees & Service" items={buildCategoryMap["Academic Committees & Service"]} />
            <Section title="Professional & Community Memberships" items={buildCategoryMap["Professional & Community Memberships"]} />
            <Section title="Conference & Event Participation" items={buildCategoryMap["Conference & Event Participation"]} />
            <Section title="Student Supervision" items={buildCategoryMap["Student Supervision"]} />
            <Section title="Collaborations & Partnerships" items={buildCategoryMap["Collaborations & Partnerships"]} />
            <Section title="Collaboration Opportunities" items={buildCategoryMap["Collaboration Opportunities"]} />
            <Section title="Awards & Recognitions" items={buildCategoryMap["Awards & Recognitions"]} />
          </div>

          <div className="no-print mt-8 flex items-center justify-end gap-3">
            <button className="rounded-2xl px-5 py-2.5 border" onClick={()=>window.scrollTo({top:0, behavior:'smooth'})}>Back to Top</button>
            <button className="rounded-2xl px-5 py-2.5" style={{background: "#000", color: "#fff"}} onClick={()=>window.print()}>Print / Save PDF</button>
          </div>
        </div>
      );
    }

    // Data Editor Tab
    function DataEditor({ objects, setObjects, byCategory, setByCategory }){
      const [query, setQuery] = useState("");
      const [raw, setRaw] = useState(JSON.stringify(objects, null, 2));
      const [selectedId, setSelectedId] = useState(null);

      useEffect(()=>{ setRaw(JSON.stringify(objects, null, 2)); }, [objects]);

      const filtered = useMemo(()=> {
        if(!query.trim()) return objects;
        const q = query.toLowerCase();
        return objects.filter(o => (o.title||"").toLowerCase().includes(q) || (o.description||"").toLowerCase().includes(q) || (o.categories||[]).join(",").toLowerCase().includes(q));
      }, [objects, query]);

      const selectForEdit = (id) => setSelectedId(id === selectedId ? null : id);
      const updateObjectField = (id, field, value) => {
        const updated = objects.map(o => o.id===id ? { ...o, [field]: value } : o);
        setObjects(updated); setByCategory(rebuildByCategory(updated));
      };
      const updateArrayField = (id, field, valueStr) => {
        const arr = valueStr.split(",").map(s=>s.trim()).filter(Boolean);
        updateObjectField(id, field, arr.length ? arr : null);
      };
      const deleteObject = (id) => {
        if(!confirm("Delete this object?")) return;
        const updated = objects.filter(o => o.id !== id);
        setObjects(updated); setByCategory(rebuildByCategory(updated));
      };

      const applyRawJSON = () => {
        try {
          const parsed = JSON.parse(raw);
          if(!Array.isArray(parsed)) { alert("objects.json must be an array"); return; }
          setObjects(parsed); setByCategory(rebuildByCategory(parsed));
          alert("Applied changes from JSON.");
        } catch (e) {
          alert("Invalid JSON: " + e.message);
        }
      };

      const handleImportObjects = async (e) => {
        const file = e.target.files?.[0]; if(!file) return;
        try {
          const json = await readJSONFile(file);
          if(!Array.isArray(json)) { alert("Expected an array in objects.json"); return; }
          setObjects(json); setByCategory(rebuildByCategory(json));
        } catch { alert("Invalid JSON"); }
      };

      return (
        <div className="mx-auto max-w-6xl px-4 py-6 grid grid-cols-1 lg:grid-cols-2 gap-6">
          {/* Left: Table editor */}
          <section className="rounded-2xl bg-white p-4 md:p-6 shadow-sm border">
            <div className="flex items-center justify-between mb-4 gap-3">
              <h2 className="text-xl font-semibold">Objects</h2>
              <input className="rounded-xl border px-3 py-2" placeholder="Search..." value={query} onChange={(e)=>setQuery(e.target.value)} />
            </div>
            <div className="max-h-[520px] overflow-auto border rounded-xl">
              <table className="w-full text-sm">
                <thead className="bg-gray-50 sticky top-0">
                  <tr>
                    <th className="p-2 text-left">Title</th>
                    <th className="p-2 text-left">Start</th>
                    <th className="p-2 text-left">End</th>
                    <th className="p-2 text-left">Categories</th>
                    <th className="p-2 text-left">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {filtered.map(o => (
                    <React.Fragment key={o.id}>
                      <tr className="border-t">
                        <td className="p-2">{o.title}</td>
                        <td className="p-2">{o.date_start || ""}</td>
                        <td className="p-2">{o.date_end || ""}</td>
                        <td className="p-2">{(o.categories||[]).join(", ")}</td>
                        <td className="p-2"><button className="rounded-lg border px-2 py-1" onClick={()=>selectForEdit(o.id)}>{selectedId===o.id ? "Close" : "Edit"}</button></td>
                      </tr>
                      {selectedId===o.id && (
                        <tr className="border-t bg-gray-50/60">
                          <td colSpan="5" className="p-3">
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                              <div className="flex flex-col gap-1">
                                <label className="text-xs">Title</label>
                                <input className="rounded-xl border px-2 py-1" value={o.title||""} onChange={(e)=>updateObjectField(o.id, "title", e.target.value)} />
                              </div>
                              <div className="flex flex-col gap-1">
                                <label className="text-xs">Organization</label>
                                <input className="rounded-xl border px-2 py-1" value={o.organization||""} onChange={(e)=>updateObjectField(o.id, "organization", e.target.value)} />
                              </div>
                              <div className="flex flex-col gap-1">
                                <label className="text-xs">Location</label>
                                <input className="rounded-xl border px-2 py-1" value={o.location||""} onChange={(e)=>updateObjectField(o.id, "location", e.target.value)} />
                              </div>
                              <div className="flex flex-col gap-1">
                                <label className="text-xs">Start</label>
                                <input className="rounded-xl border px-2 py-1" value={o.date_start||""} onChange={(e)=>updateObjectField(o.id, "date_start", e.target.value)} />
                              </div>
                              <div className="flex flex-col gap-1">
                                <label className="text-xs">End</label>
                                <input className="rounded-xl border px-2 py-1" value={o.date_end||""} onChange={(e)=>updateObjectField(o.id, "date_end", e.target.value)} />
                              </div>
                              <div className="flex flex-col gap-1 md:col-span-2">
                                <label className="text-xs">Description</label>
                                <textarea className="rounded-xl border px-2 py-1 min-h-[80px]" value={o.description||""} onChange={(e)=>updateObjectField(o.id, "description", e.target.value)} />
                              </div>
                              <div className="flex flex-col gap-1">
                                <label className="text-xs">Roles (comma separated)</label>
                                <input className="rounded-xl border px-2 py-1" value={(o.roles||[]).join(", ")} onChange={(e)=>updateArrayField(o.id, "roles", e.target.value)} />
                              </div>
                              <div className="flex flex-col gap-1">
                                <label className="text-xs">Categories (comma separated)</label>
                                <input className="rounded-xl border px-2 py-1" value={(o.categories||[]).join(", ")} onChange={(e)=>updateArrayField(o.id, "categories", e.target.value)} />
                              </div>
                              <div className="flex flex-col gap-1">
                                <label className="text-xs">Tags (comma separated)</label>
                                <input className="rounded-xl border px-2 py-1" value={(o.tags||[]).join(", ")} onChange={(e)=>updateArrayField(o.id, "tags", e.target.value)} />
                              </div>
                              <div className="flex flex-col gap-1">
                                <label className="text-xs">Links (comma separated)</label>
                                <input className="rounded-xl border px-2 py-1" value={(o.links||[]).join(", ")} onChange={(e)=>updateArrayField(o.id, "links", e.target.value)} />
                              </div>
                              <div className="flex items-center justify-between md:col-span-2 mt-2">
                                <button className="rounded-lg border px-3 py-1 text-red-600 border-red-300" onClick={()=>deleteObject(o.id)}>Delete</button>
                                <span className="text-xs text-gray-500">ID: {o.id}</span>
                              </div>
                            </div>
                          </td>
                        </tr>
                      )}
                    </React.Fragment>
                  ))}
                </tbody>
              </table>
            </div>
          </section>

          {/* Right: Raw JSON editor */}
          <section className="rounded-2xl bg-white p-4 md:p-6 shadow-sm border">
            <div className="flex items-center justify-between mb-3 gap-2">
              <h2 className="text-xl font-semibold">Raw JSON (objects.json)</h2>
              <div className="flex gap-2">
                <button className="rounded-xl border px-3 py-2" onClick={()=>downloadJSON("cv_objects.json", objects)}>Download</button>
                <label className="cursor-pointer rounded-xl border px-3 py-2 bg-white shadow-sm text-sm">Import
                  <input type="file" className="hidden" accept="application/json" onChange={handleImportObjects} />
                </label>
              </div>
            </div>
            <textarea className="w-full h-[480px] rounded-xl border p-3" value={raw} onChange={(e)=>setRaw(e.target.value)}></textarea>
            <div className="mt-3 flex gap-2">
              <button className="rounded-2xl px-4 py-2 bg-black text-white" onClick={applyRawJSON}>Validate & Apply</button>
              <button className="rounded-2xl px-4 py-2 border" onClick={()=>setRaw(JSON.stringify(objects, null, 2))}>Reset to Current</button>
            </div>
            <p className="text-xs text-gray-500 mt-2">Tip: Paste your edited JSON above and click <em>Validate & Apply</em> to update the app state.</p>
          </section>
        </div>
      );
    }

    // App Shell
    function App(){
      const [page, setPage] = useState("builder");
      const [objects, setObjects] = useState([]);
      const [byCategory, setByCategory] = useState({});

      useEffect(()=>{
        const saved = localStorage.getItem("cv_object_builder_data");
        if(saved){ try{ const parsed = JSON.parse(saved); setObjects(parsed.objects||[]); setByCategory(parsed.byCategory||{});} catch{} }
      },[]);
      useEffect(()=>{
        localStorage.setItem("cv_object_builder_data", JSON.stringify({ objects, byCategory }));
      },[objects, byCategory]);

      return (
        <div>
          <nav className="no-print sticky top-0 z-20 bg-white/80 backdrop-blur border-b">
            <div className="mx-auto max-w-6xl px-4 py-3 flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="w-2.5 h-6 rounded-full" style={{background: ACCENT}}></div>
                <span className="font-semibold">CV Builder</span>
              </div>
              <div className="flex gap-2">
                <button onClick={()=>setPage("builder")} className={"rounded-xl px-4 py-2 border " + (page==="builder"?"ring-2 ring-purple-600":"")}>Builder</button>
                <button onClick={()=>setPage("cv")} className={"rounded-xl px-4 py-2 border " + (page==="cv"?"ring-2 ring-purple-600":"")}>CV</button>
                <button onClick={()=>setPage("data")} className={"rounded-xl px-4 py-2 border " + (page==="data"?"ring-2 ring-purple-600":"")}>Data</button>
              </div>
            </div>
          </nav>

          {page==="builder" && <Builder objects={objects} setObjects={setObjects} byCategory={byCategory} setByCategory={setByCategory} />}
          {page==="cv" && <CVRenderer objects={objects} byCategory={byCategory} />}
          {page==="data" && <DataEditor objects={objects} setObjects={setObjects} byCategory={byCategory} setByCategory={setByCategory} />}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
